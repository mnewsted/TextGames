Trying to split the code into meaningful modules.
